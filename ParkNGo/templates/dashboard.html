{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4">Dashboard</h2>

<!-- Your Listed Parking Spaces -->
<h3 class="mt-4">My Parking Spaces</h3>
<div class="row row-cols-1 row-cols-md-3 g-4">
    {% for space in spaces %}
    <div class="col">
        <div class="card h-100">
            {% if space.image %}
            <img src="{{ url_for('static', filename='uploads/' + space.image) }}" class="card-img-top" alt="{{ space.title }}">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ space.title }}</h5>
                <p class="card-text">
                    <strong>Location:</strong> {{ space.address }}<br>
                    <strong>City:</strong> {{ space.city }}<br>
                    <strong>Area:</strong> {{ space.area }}<br>
                    <strong>Price:</strong> ₹{{ space.price_per_hour }}/hour<br>
                    <strong>Available Slots:</strong> {{ space.available_slots }}/{{ space.total_slots }}
                </p>
                <a href="{{ url_for('space_details', space_id=space.id) }}" class="btn btn-primary">View Details</a>
<form action="{{ url_for('delete_space', space_id=space.id) }}" method="POST" style="display:inline;">
  <button type="submit" class="btn btn-danger btn-sm mt-2" onclick="return confirm('Are you sure you want to delete this space?');">Delete</button>
</form>
            </div>
        </div>
    </div>
    {% else %}
    <p>You haven’t listed any parking spaces yet.</p>
    {% endfor %}
</div>

<hr class="my-5"> 

<h3 class="mt-5">Bookings on Your Listed Spaces</h3>
{% if bookings_on_my_spaces %}
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Parking Title</th>
      <th>Booked By</th>
      <th>Contact</th>
      <th>Hours</th>
      <th>Booking Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for booking in bookings_on_my_spaces %}
    <tr>
      <td>{{ booking['title'] }}</td>
      <td>{{ booking['name'] }}</td>
      <td>{{ booking['contact'] }}</td>
      <td>{{ booking['hours'] }}</td>
      <td>{{ booking['booking_date'] }}</td>
      <td>
        <form action="{{ url_for('reject_booking', booking_id=booking['id']) }}" method="POST">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Reject this booking?');">Reject</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No one has booked your spaces yet.</p>
{% endif %}

<!-- Divider -->
<hr class="my-5">

<!-- Your Bookings -->
<h3 class="mt-4">My Bookings</h3>
{% if bookings %}
<div class="table-responsive">
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Parking Title</th>
                <th>Address</th>
                <th>City</th>
                <th>Booked Hours</th>
                <th>Booking Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for booking in bookings %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ booking.title }}</td>
                <td>{{ booking.address }}</td>
                <td>{{ booking.city }}</td>
                <td>{{ booking.hours }}</td>
                <td>{{ booking.booking_date }}</td>
                <td>
                    <form action="{{ url_for('cancel_booking', booking_id=booking.id) }}" method="POST">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Cancel this booking?');">Cancel</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>You haven’t booked any parking spaces yet.</p>
{% endif %}


{% endblock %}
